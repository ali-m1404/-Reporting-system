@using Report.Application.Dtos
@model List<Report.Application.Dtos.UserDto>

@{
    var searchValue = Context.Request.Query["search"].ToString();
    var roleValue = Context.Request.Query["role"].ToString();
    var statusValue = Context.Request.Query["status"].ToString();
}

<div id="content-area" class="bg-white shadow-md rounded-lg p-6">
    <div class="fade-in">

        <!-- Header -->
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold text-gray-800">مدیریت کاربران</h2>

            <button id="add-user-btn"
                    class="btn btn-primary"
                    onclick="goToRegistrationPage()">
                <i class="fas fa-plus mr-2"></i>
                افزودن کاربر
            </button>
        </div>

        <div class="bg-white rounded-xl shadow-md overflow-hidden">

            <!-- Search & Filters -->
           <form method="get" class="p-4 border-b border-gray-200 flex flex-col md:flex-row md:items-center md:justify-between">
                    <!-- جستجو -->
                    <div class="mb-4 md:mb-0">
                        <input type="text"
                               name="search"
                               value="@searchValue"
                               placeholder="جستجوی کاربر..."
                               class="form-input w-full md:w-64">
                    </div>

                    <!-- فیلتر نقش و وضعیت -->
                    <div class="flex space-x-2">
                        <select name="role" class="form-input w-full md:w-auto">
                            <option value="superadmin" selected="@(roleValue == "superadmin")">سوپر ادمین</option>
                            <option value="admin" selected="@(roleValue == "admin")">ادمین</option>
                            <option value="user" selected="@(roleValue == "user")">کاربر ساده</option>

                        </select>

                        <select name="status" class="form-input w-full md:w-auto">
                            <option value="">همه وضعیت‌ها</option>
                            <option value="active" selected="@(statusValue == "active")">فعال</option>
                            <option value="inactive" selected="@(statusValue == "inactive")">غیرفعال</option>
                          

                        </select>

                            <button type="submit" class="btn btn-primary ml-2">
                                 فیلتر
                            </button>
                    </div>
           </form>
            <!-- Table -->
            <div class="overflow-x-auto">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>نام کاربر</th>
                            <th>ایمیل</th>
                            <th>شماره تماس</th>
                            <th>نقش</th>
                            <th>وضعیت</th>
                            <th>تاریخ عضویت</th>
                            <th>عملیات</th>
                        </tr>
                    </thead>

                    <tbody>

                        @if (!Model.Any())
                        {
                            <tr>
                                <td colspan="7" class="text-center text-gray-500 py-6">
                                    کاربری یافت نشد
                                </td>
                            </tr>
                        }
                        else
                        {
                            foreach (var user in Model)
                            {
                                <tr>
                                    <!-- Name -->
                                    <td>
                                        <div class="flex items-center">
                                            <img src="@(string.IsNullOrEmpty(user.ProfileImagePath) ? "~/assets/images/user-placeholder.jpg" : user.ProfileImagePath)"
                                                 alt="@user.UserName"
                                                 class="w-8 h-8 rounded-full mr-3">
                                            <span>@user.UserName</span>
                                        </div>
                                    </td>


                                    <!-- Email -->
                                    <td>@user.Email</td>

                                    <!-- Phone -->
                                    <td>@user.Phone</td>

                                    <!-- Role -->
                                    <td>@user.RoleTitle</td>

                                    <!-- Status -->
                                    <td>
                                        @if (user.IsActive)
                                        {
                                            <span class="status-active">فعال</span>
                                        }
                                        else
                                        {
                                            <span class="status-inactive">غیرفعال</span>
                                        }
                                    </td>

                                    <!-- Created Date -->
                                    <td>@(user.RegisterDate.HasValue? user.RegisterDate.Value.ToString("dd/MM/yyyy") : "-")</td>



                                    <!-- Actions -->
                                    <td>
                                        <div class="flex space-x-2">
                                            @* <button class="text-blue-600 hover:text-blue-800 view-user"
                                                    data-id="@user.Id">
                                               <a><i class="fas fa-eye"></i></a>
                                            </button> *@

                                            <a class="text-yellow-600 hover:text-yellow-800"
                                               asp-controller="UserManagement"
                                               asp-action="Edit"
                                               asp-route-id="@user.Id">
                                                <i class="fas fa-edit"></i>
                                            </a>

                                            <a class="text-red-600 hover:text-red-800 delete-user"
                                               asp-controller="UserManagement"
                                               asp-action="Delete"
                                               asp-route-id="@user.Id">
                                                <i class="fas fa-trash"></i>
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                            }
                        }

                    </tbody>
                </table>
            </div>

            <!-- Footer -->
            <div class="p-4 border-t border-gray-200 flex justify-between items-center">
                <div class="text-sm text-gray-500">
                    نمایش @Model.Count کاربر
                </div>

                <div class="flex space-x-2">
                    <button class="px-3 py-1 bg-gray-200 rounded-md text-gray-700" disabled>
                        قبلی
                    </button>

                    <button class="px-3 py-1 bg-blue-600 text-white rounded-md">
                        1
                    </button>

                    <button class="px-3 py-1 bg-gray-200 rounded-md text-gray-700" disabled>
                        بعدی
                    </button>
                </div>
            </div>

        </div>
    </div>
</div>

<script>
    function goToRegistrationPage() {
        window.location.href = '/Account/Register';
    }
</script>
